# 保护模式下的中断

## 不能用BIOS中断

在保护模式下。中断机制发生了很大的变化，原来的中断向量表已经被IDT所代替，实模式下能用的BIOS中断在保护模式下已经不能用了。

## IDT——一个类似GDT和LDT的东西

* IDT（Interrupt Descriptor Table）：中断描述符表
  * 中断门描述符
  * 陷阱门描述符
  * 任务门描述符

* IDT的作用就是把每一个中断向量和一个描述符对应起来

* 任务门描述符：

|16位|1位|2位|5位|8位|16位|16位|
|:--:|:--:|:--:|:--:|:--:|:--:|:--:|
|空闲不用|P|DPL|00101|空闲不用|TSS段选择码|空闲不用|

* 段存在标志P（Segment present）：用于指出一个段是在内存中（P=1）还是不在内存中（P=0

* 描述符特权级DPL（Descriptor Privilege Level ）：用来实现保护机制特权级范围从0到3。0级特权级最高，3级最低。DPL用于控制对段的访问。

* 00101：S + D + 类型码（101表示任务门）
  * S:描述符标志（系统段还是数据代码段）
  * D:标志位（0表示16位，1表示32位）

* 中断门，陷阱门：

|16位|1位|2位|1位|1位|3位|3位|5位|16位|16位|
|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|
|偏移高16位|P|DPL|0|D|类型码|000|空闲不用|段选择码|偏移低16位|

* 110：中断门
* 111：陷阱门
* 100，调用门

---

* TODO: 对各种门的描述还不太仔细
